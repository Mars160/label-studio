{% extends 'base.html' %}
{% block head %}
<script src="static/js/polyfill.min.js"></script>
<script src="static/js/vue.js"></script>
<script src="static/js/components/vue-tippy.min.js"></script>
<script src="static/semantic/semantic-ui-vue.min.js"></script>

<link rel="stylesheet" href="static/css/import-new.css">
{% endblock %}
{% block body %}
{% include 'includes/import_storages.html' %}
{% include 'includes/import_files.html' %}
{% raw %}

  <!-- Spinner while vue loading -->
  <div id="vue_loader" class="ui large text loader loading active">Loading ...</div>

  <!-- Vue app -->
  <div class="ui" id="import-tasks" :class="{ hidden: !vueLoaded }">
    <div v-if="preview">
      <h1>Files loaded</h1>
      <table>
        <tr v-for="row in preview">
          <td v-for="value in row">{{value}}</td>
        </tr>
      </table>
    </div>

    <div v-if="loading">Loading...</div>

    <div :class="{ hidden: loading || preview }">
      <div class="source-switch">
        <span>Source</span>
        <div class="ui buttons">
          <button
            v-for="title, name in sources"
            class="ui basic button"
            :class="{ primary: source === name, ['state-' + name]: true }"
            @click="source=name"
          >{{title}}</button>
        </div>
      </div>

      <div class="ui form tab-files" v-if="source === 'files'" ref="files">
        <import-files @start="start" @finish="finish"></import-files>
      </div>

      <div class="ui form tab-url" v-if="source === 'url'" ref="url">
        <h2>By URL</h2>
      </div>

      <div class="ui form tab-cloud" v-if="source === 'cloud'" ref="cloud">
        <cloud-storages @finish="finish"></cloud-storages>
      </div>
    </div>
  </div>

  <script>
    Vue.use(SemanticUIVue);
    Vue.use(VueTippy);

    var app = new Vue({
      el: '#import-tasks',
      components: ["cloud-storages"],

      data: function () {

        return {
          loading: false,
          preview: null,
          vueLoaded: false, 
          source: 'files',
          sources: {'files': 'Files', 'url': 'URL', 'cloud': 'Cloud'},
        };
      },

      methods: {
        start: function() {
          this.loading = true;
        },

        finish: function(data) {
          this.loading = false;
          this.preview = ["config.xml", "index.js", "tasks.json"]
            .map((filename, i) => ({ id: i + 1, filename: '/usr/heartex/examples/' + filename }));
        }
      },

      watch: {

      },

      // vue mounting of page
      mounted: function () {
        this.vueLoaded = true;

        $('#vue_loader').hide();
        console.log('Vue mounting success');
      }
    });
  </script>

{% endraw %}
{% endblock %}
